<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Stock Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar / Market Watch -->
        <aside class="sidebar">
            <div class="brand-section">
                <div class="app-logo-small">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    <span>ProPredict</span>
                </div>
            </div>
            <div class="sidebar-header">
                <h2>Market Watch</h2>
                <p style="font-size: 0.8rem; color: var(--text-secondary);">Live Market Data</p>
            </div>
            <div id="market-list" class="market-list">
                <!-- Market items will be injected here -->
                <div class="loading-text">Loading market data...</div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="header-brand">
                        <div class="logo-container">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <defs>
                                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" stop-color="#3b82f6" />
                                        <stop offset="100%" stop-color="#a855f7" />
                                    </linearGradient>
                                </defs>
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                        </div>
                        <div>
                            <h1>AI Stock Predictor</h1>
                            <p>Advanced LSTM Neural Network Analysis & Forecasting</p>
                        </div>
                    </div>
                    <button onclick="openSettings()" class="settings-btn" title="Settings">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"></path>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Input Section -->
            <div class="card">
                <div class="input-grid">
                    <div class="form-group" style="position: relative;">
                        <label for="ticker">Stock Ticker</label>
                        <div class="search-container">
                            <input type="text" id="ticker" placeholder="Search (e.g. NVDA, AAPL)..." autocomplete="off"
                                required>
                            <div id="ticker-dropdown" class="dropdown-results hidden"></div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="look_back">Look-Back (Days)</label>
                        <input type="number" id="look_back" value="60" min="10" max="365">
                    </div>
                    <div class="input-group">
                        <label for="forecast_days">Forecast (Days)</label>
                        <input type="number" id="forecast_days" value="7" min="1" max="30">
                    </div>
                    <div class="input-group">
                        <label for="model_type">Prediction Model</label>
                        <select id="model_type">
                            <option value="lstm">LSTM (Deep Learning)</option>
                            <option value="gru">GRU (Deep Learning)</option>
                            <option value="linear">Linear Regression (Fast)</option>
                            <option value="random_forest">Random Forest (ML)</option>
                            <option value="xgboost">XGBoost (ML)</option>
                        </select>
                    </div>
                    <button id="predict-btn" onclick="predictPrice()" class="primary-btn">Analyze & Predict</button>
                </div>

                <div id="loading" class="hidden">
                    <div class="spinner"></div>
                    <p>Training model and generating predictions...</p>
                </div>

                <div id="error-msg" class="error hidden"></div>

                <div id="results" class="hidden">
                    <div class="chart-container">
                        <canvas id="stockChart"></canvas>
                    </div>

                    <div class="analysis-grid">
                        <div class="card recommendation-card">
                            <h3>AI Recommendation</h3>
                            <div id="recommendation-badge" class="badge">HOLD</div>
                            <div id="signal-list" class="signal-list"></div>
                        </div>
                        <div class="card stats-card">
                            <h3>Technical Indicators</h3>
                            <div class="stat-row">
                                <span>RSI (14)</span>
                                <span id="rsi-value">--</span>
                            </div>
                            <div class="stat-row">
                                <span>SMA (50)</span>
                                <span id="sma-value">--</span>
                            </div>
                            <div class="stat-row">
                                <span>RMSE (Error)</span>
                                <span id="rmse-value">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Interface -->
                <div class="chat-container">
                    <div class="chat-header">
                        <h3>AI Market Assistant</h3>
                        <div class="model-selectors">
                            <select id="chat-provider" onchange="updateModelOptions()">
                                <option value="openai">OpenAI</option>
                                <option value="gemini">Google Gemini</option>
                            </select>
                            <select id="chat-model">
                                <option value="gpt-5.1">GPT-5.1 (Latest)</option>
                                <option value="gpt-5-mini">GPT-5 Mini</option>
                                <option value="gpt-4o">GPT-4o (Multimodal)</option>
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            </select>
                        </div>
                    </div>
                    <div id="chat-history" class="chat-history">
                        <div class="message system">
                            Hello! I can analyze the current stock data for you. Select a stock and ask me anything.
                        </div>
                    </div>
                    <div id="chat-loading" class="chat-loading hidden">
                        <div class="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span class="loading-text">AI is thinking...</span>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="chat-input" placeholder="Ask about this stock..."
                            onkeypress="handleChatKey(event)">
                        <button onclick="sendChatMessage()" class="send-btn">Send</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button onclick="closeSettings()" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="openai-key">OpenAI API Key</label>
                    <input type="password" id="openai-key" placeholder="sk-..." autocomplete="off">
                    <small>Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a></small>
                </div>
                <div class="form-group">
                    <label for="gemini-key">Google Gemini API Key</label>
                    <input type="password" id="gemini-key" placeholder="AIza..." autocomplete="off">
                    <small>Get your API key from <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a></small>
                </div>
                <div id="settings-status" class="status-message"></div>
            </div>
            <div class="modal-footer">
                <button onclick="closeSettings()" class="secondary-btn">Cancel</button>
                <button onclick="saveSettings()" class="primary-btn">Save Settings</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>